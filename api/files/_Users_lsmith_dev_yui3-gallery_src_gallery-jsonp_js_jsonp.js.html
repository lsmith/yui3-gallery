<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/lsmith/dev/yui3-gallery/src/gallery-jsonp/js/jsonp.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.4.0/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.4.0/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png">undefined: /Users/lsmith/dev/yui3-gallery/src/gallery-jsonp/js/jsonp.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/DataSchema.html">DataSchema</a></li>
            
                <li><a href="../classes/DataTable.html">DataTable</a></li>
            
                <li><a href="../classes/DataTable.Base.html">DataTable.Base</a></li>
            
                <li><a href="../classes/DataTable.BodyView.html">DataTable.BodyView</a></li>
            
                <li><a href="../classes/DataTable.ColumnWidths.html">DataTable.ColumnWidths</a></li>
            
                <li><a href="../classes/DataTable.Core.html">DataTable.Core</a></li>
            
                <li><a href="../classes/DataTable.HeaderView.html">DataTable.HeaderView</a></li>
            
                <li><a href="../classes/DataTable.Message.html">DataTable.Message</a></li>
            
                <li><a href="../classes/DataTable.Mutable.html">DataTable.Mutable</a></li>
            
                <li><a href="../classes/DataTable.Scrollable.html">DataTable.Scrollable</a></li>
            
                <li><a href="../classes/DataTable.Sortable.html">DataTable.Sortable</a></li>
            
                <li><a href="../classes/JSONPRequest.html">JSONPRequest</a></li>
            
                <li><a href="../classes/Plugin.html">Plugin</a></li>
            
                <li><a href="../classes/YUI~event-drag.html">YUI~event-drag</a></li>
            
                <li><a href="../classes/YUI~event-konami.html">YUI~event-konami</a></li>
            
                <li><a href="../classes/YUI~toRelativeTime.html">YUI~toRelativeTime</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/dataschema.html">dataschema</a></li>
            
                <li><a href="../modules/dataschema-class.html">dataschema-class</a></li>
            
                <li><a href="../modules/datatable-base.html">datatable-base</a></li>
            
                <li><a href="../modules/datatable-body.html">datatable-body</a></li>
            
                <li><a href="../modules/datatable-column-widths.html">datatable-column-widths</a></li>
            
                <li><a href="../modules/datatable-core.html">datatable-core</a></li>
            
                <li><a href="../modules/datatable-head.html">datatable-head</a></li>
            
                <li><a href="../modules/datatable-message.html">datatable-message</a></li>
            
                <li><a href="../modules/datatable-mutable.html">datatable-mutable</a></li>
            
                <li><a href="../modules/datatable-scroll.html">datatable-scroll</a></li>
            
                <li><a href="../modules/datatable-sort.html">datatable-sort</a></li>
            
                <li><a href="../modules/event-drag.html">event-drag</a></li>
            
                <li><a href="../modules/event-konami.html">event-konami</a></li>
            
                <li><a href="../modules/gallery-jsonp.html">gallery-jsonp</a></li>
            
                <li><a href="../modules/gallery-pluginattr.html">gallery-pluginattr</a></li>
            
                <li><a href="../modules/gallery-torelativetime.html">gallery-torelativetime</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
    </div>


            <div class="apidocs">
                <div id="docs-main" class="content">
                    <h1 class="file-heading">File: /Users/lsmith/dev/yui3-gallery/src/gallery-jsonp/js/jsonp.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var isObject   = Y.Lang.isObject,
    isFunction = Y.Lang.isFunction;

/**
 * &lt;p&gt;Provides a JSONPRequest class for repeated JSONP calls, and a convenience
 * method Y.jsonp(url, callback) to instantiate and send a JSONP request.&lt;/p&gt;
 *
 * &lt;p&gt;The callback for the response can be named in the url explicitly or
 * provided in the configuration (second parameter to the constructor).
 *
 * &lt;p&gt;By default, the query parameter string &quot;callback=???&quot; will be
 * searched for in the url (??? can be anything).  If it's not found, it will
 * be added on.  If the JSONP service uses a different parameter name or url
 * format, you can override this behavior with the &lt;code&gt;format&lt;/code&gt; property
 * in the callback config.&lt;/p&gt;
 *
 * &lt;p&gt;The second parameter can be a callback function that accepts the JSON
 * payload as its argument, or a configuration object supporting the keys:&lt;/p&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;on - map of callback subscribers
 *      &lt;ul&gt;
 *         &lt;li&gt;success - function handler for successful transmission&lt;/li&gt;
 *         &lt;li&gt;failure - function handler for failed transmission&lt;/li&gt;
 *         &lt;li&gt;timeout - function handler for transactions that timeout&lt;/li&gt;
 *      &lt;/ul&gt;
 *  &lt;/li&gt;
 *  &lt;li&gt;format  - override function for inserting the proxy name in the url&lt;/li&gt;
 *  &lt;li&gt;timeout - the number of milliseconds to wait before giving up&lt;/li&gt;
 *  &lt;li&gt;context - becomes &lt;code&gt;this&lt;/code&gt; in the callbacks&lt;/li&gt;
 *  &lt;li&gt;args    - array of subsequent parameters to pass to the callbacks&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * @module gallery-jsonp
 * @class JSONPRequest
 * @constructor
 * @param url {String} the url of the JSONP service
 * @param callback {Object|Function} the default callback configuration or
 *                                   success handler
 */
function JSONPRequest() {
    this._init.apply( this, arguments );
}

/**
 * RegExp used by the default URL formatter to insert the generated callback
 * name into the JSONP url.  Looks for a query param callback=.  If a value is
 * assigned, it will be clobbered.
 *
 * @member JSONPRequest._pattern
 * @type RegExp
 * @default /\bcallback=.*?(?=&amp;|$)/i
 * @protected
 * @static
 */
JSONPRequest._pattern = /\bcallback=(.*?)(?=&amp;|$)/i;

/**
 * Template used by the default URL formatter to add the callback function name
 * to the url.
 *
 * @member JSONPRequest._template
 * @type String
 * @default "callback={callback}"
 * @protected
 * @static
 */
JSONPRequest._template = "callback={callback}";

JSONPRequest.prototype = {
    /**
     * Set up the success and failure handlers and the regex pattern used
     * to insert the temporary callback name in the url.
     *
     * @method _init
     * @param url {String} the url of the JSONP service
     * @param callback {Object|Function} Optional success callback or config
     *                  object containing success and failure functions and
     *                  the url regex.
     * @protected
     */
    _init : function ( url, callback ) {
        this.url = url;

        callback = callback || {};

        if ( isFunction( callback ) ) {
            callback = { on: { success: callback } };
        }

        callback.on = callback.on || {};

        if ( !callback.on.success ) {
            callback.on.success = this._getCallbackFromUrl( url );
        }

        // Apply defaults and store
        this._config = Y.merge( {
                on     : {},
                context: this,
                args   : [],
                format : this._format
            }, callback );

    },

    /**
     * &lt;p&gt;Parses the url for a callback named explicitly in the string.
     * Override this if the target JSONP service uses a different query
     * parameter or url format.&lt;/p&gt;
     *
     * &lt;p&gt;If the callback is declared inline, the corresponding function will
     * be returned.  Otherwise null.&lt;/p&gt;
     *
     * @method _getCallbackFromUrl
     * @param url { String } the url to search in
     * @return { Function } the callback function if found, or null
     * @protected
     */
    _getCallbackFromUrl: function ( url ) {
        var match = url.match( JSONPRequest._pattern ),
            callback, context, bits, i;

        if ( match ) {
            // resolve from the global
            context = Y.config.win;

            // callback=foo.bar.func =&gt; [ 'func', 'bar', 'foo' ]
            // @TODO doesn't support bracket notation (callback=foo["bar"].func)
            bits = match[1].split( /\./ ).reverse();

            callback = bits.shift();

            for ( i = bits.length - 1; i &gt;= 0; --i ) {
                context = context[ bits[ i ] ];
                if ( !isObject( context ) ) {
                    return null;
                }
            }

            if ( isObject( context ) &amp;&amp; isFunction( context[ callback ] ) ) {
                // bind to preserve context declared inline, so
                // callback=foo.bar.func =&gt; 'this' is foo.bar in func
                return Y.bind( context[ callback ], context );
            }
        }

        return null;
    },

    /** 
     * Issues the JSONP request.
     *
     * @method send
     * @chainable
     */
    send : function ( callback ) {
        if ( !this._config.on.success ) {
            Y.log( "No success handler defined.  Aborting JSONP request.", "warn", "jsonp" );
            return this;
        }

        var proxy  = Y.guid().replace( /-/g, '_' ),
            config = this._config,
            url    = config.format.call( this,
                        this.url, 'YUI.Env.JSONP.' + proxy );

        function wrap( fn ) {
            return ( isFunction( fn ) ) ?
                function ( data ) {
                    delete YUI.Env.JSONP[ proxy ];
                    fn.apply( config.context, [ data ].concat( config.args ) );
                } :
                null;
        }

        // Temporary un-sandboxed function alias
        YUI.Env.JSONP[ proxy ] = wrap( config.on.success );

        Y.Get.script( url, {
            onFailure: wrap( config.on.failure ),
            onTimeout: wrap( config.on.timeout || config.on.failure ),
            timeout  : config.timeout
        } );

        return this;
    },

    /**
     * Default url formatter.  Looks for callback= in the url and appends it
     * if not present.  The supplied proxy name will be assigned to the query
     * param.  Override this method by passing a function as the
     * &quot;format&quot; property in the config object to the constructor.
     *
     * @method _format
     * @param url { String } the original url
     * @param proxy {String} the function name that will be used as a proxy to
     *      the configured callback methods.
     * @return {String} fully qualified JSONP url
     * @protected
     */
    _format: function ( url, proxy ) {
        var callback  = JSONPRequest._template.replace(/\{callback\}/, proxy),
            lastChar;

        if (JSONPRequest._pattern.test(url)) {
            return url.replace(JSONPRequest._pattern, callback);
        } else {
            lastChar = url.slice(-1);
            if (lastChar !== '&amp;' &amp;&amp; lastChar !== '?') {
                url += (url.indexOf('?') &gt; -1) ? '&amp;' : '?';
            }
            return url + callback;
        }
    }

};

Y.JSONPRequest = JSONPRequest;

/**
 *
 * @method Y.jsonp
 * @param url {String} the url of the JSONP service with the {callback}
 *          placeholder where the callback function name typically goes.
 * @param c {Function|Object} Callback function accepting the JSON payload
 *          as its argument, or a configuration object (see above).
 * @return {JSONPRequest}
 * @static
 */
Y.jsonp = function (url,c) {
    return new Y.JSONPRequest(url,c).send();
};

if (!YUI.Env.JSONP) {
    YUI.Env.JSONP = {};
}

    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<!--script src="../assets/js/tabs.js"></script-->
<script src="../assets/../api.js"></script>


<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
