YUI.add("gallery-twitter-status",function(D){var B=/@(\w+)/g,A=/((?:https?|s?ftp|ssh)\:\/\/[^"\s<>]*[^.,;'">\:\s<>\)\]\!])/g;function C(){C.superclass.constructor.apply(this,arguments);}D.mix(C,{NAME:"twitterstatus",TWITTER_URL:"http://twitter.com/",FEED_URI:"statuses/user_timeline/",ENTRY_TEMPLATE:'<div class="twitter-status-update">'+"<p>{text} "+'<span class="twitter-status-timestamp">{relativeTime}</span>'+"</p>"+"</div>",TITLE_TEMPLATE:'<h3 class="twitter-status-title">{title} '+'<a href="{url}" class="twitter-status-username">{username}</a>'+"</h3>",ATTRS:{username:{},count:{value:10,validator:D.Lang.isNumber},refreshSeconds:{value:300,validator:D.Lang.isNumber},strings:{value:{title:"Latest Updates",error:"Oops!  We had some trouble connecting to Twitter :("}},includeTitle:{value:true,validator:D.Lang.isBoolean}}});D.extend(C,D.Widget,{interval:null,initializer:function(){this.publish({data:{defaultFn:this._defDataFn},error:{defaultFn:this._defErrorFn}});this._initJSONPRequest();this.after({usernameChange:this._refreshJSONPRequest,countChange:this._refreshJSONPRequest});},_initJSONPRequest:function(){var E=this.get("username"),F=C.TWITTER_URL+C.FEED_URI+E+".json?"+"d="+(new Date()).getTime()+"&count="+this.get("count");this._jsonpHandle=new D.JSONPRequest(F,{on:{success:this._handleJSONPResponse},context:this});},_refreshJSONPRequest:function(){this._initJSONPRequest();this.syncUI();},renderUI:function(){var E=this.get("contentBox");if(!E.one("ul.twitter-status-updates")){E.append('<ul class="twitter-status-updates"></ul>');}},bindUI:function(){this.after("usernameChange",this.syncUI);this.after("countChange",this.syncUI);this.after("stringsChange",this.syncUI);this.after("refreshSecondsChange",this._updateInterval);},syncUI:function(){this._uiUpdateTitle();this.update();this._updateInterval();},_uiUpdateTitle:function(){var E=this.get("contentBox"),H=E.one(".twitter-status-title"),G,F;if(this.get("includeTitle")){F=this.get("username");G=D.substitute(C.TITLE_TEMPLATE,{title:this.get("strings.title"),username:"@"+F,url:C.TWITTER_URL+F});if(H){H.replace(G);}else{E.prepend(G);}}else{if(H){H.remove();}}},update:function(){this._jsonpRequest.send();},_handleJSONPResponse:function(E){if(D.Lang.isObject(E)){this.fire("data",{data:E});}else{this.fire("error");}},_defDataFn:function(E){this.get("contentBox").removeClass("twitter-status-error");this._printEntries(E.data);},_printEntries:function(G){var F=this.get("contentBox"),E=this._createEntries(G);F.one(".twitter-status-updates").setContent("<li>"+E.join("</li><li>")+"</li>");},_createEntries:function(G){var E=[],F;for(F=G.length-1;F>=0;--F){G[F].relativeTime=D.toRelativeTime(new Date(Date.parse(G[F].created_at.replace(/\+\d+/,""))));E[F]=this._createEntry(G[F]);}return E;},_createEntry:function(E){return D.substitute(C.ENTRY_TEMPLATE,E).replace(A,'<a href="$1">$1</a>').replace(B,'<a class="twitter-acct" href="'+C.TWITTER_URL+'$1">@$1</a>');},_defErrorFn:function(){this.get("contentBox").addClass("twitter-status-error").setContent("<li><em>"+this.get("strings.error")+"</em></li>");},_updateInterval:function(){if(this.interval){this.interval.cancel();}this.interval=D.later(this.get("refreshSeconds")*1000,this,this.update,null,true);}});D.namespace("Twitter").Status=C;},"@VERSION@",{requires:["widget","substitute","gallery-torelativetime","gallery-jsonp"]});